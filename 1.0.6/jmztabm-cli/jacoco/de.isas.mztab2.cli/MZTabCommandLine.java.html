<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>MZTabCommandLine.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">jmztabm-cli</a> &gt; <a href="index.source.html" class="el_package">de.isas.mztab2.cli</a> &gt; <span class="el_source">MZTabCommandLine.java</span></div><h1>MZTabCommandLine.java</h1><pre class="source lang-java linenums">/* 
 * Copyright 2018 Leibniz-Institut für Analytische Wissenschaften – ISAS – e.V..
 *
 * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
package de.isas.mztab2.cli;

import com.fasterxml.jackson.databind.ObjectMapper;
import com.fasterxml.jackson.databind.SerializationFeature;
import de.isas.mztab2.io.MzTabFileParser;
import de.isas.mztab2.io.MzTabNonValidatingWriter;
import de.isas.mztab2.model.MzTab;
import de.isas.mztab2.model.ValidationMessage;
import static de.isas.mztab2.model.ValidationMessage.MessageTypeEnum.ERROR;
import static de.isas.mztab2.model.ValidationMessage.MessageTypeEnum.WARN;
import de.isas.mztab2.validation.CvMappingValidator;
import java.io.BufferedOutputStream;
import java.io.File;
import java.io.FileOutputStream;
import java.io.IOException;
import java.io.PrintStream;
import java.net.MalformedURLException;
import java.net.URI;
import java.net.URISyntaxException;
import java.time.Instant;
import java.util.List;
import java.util.Properties;
import java.util.stream.Collectors;
import javax.xml.bind.JAXBException;
import org.apache.commons.cli.*;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import uk.ac.ebi.pride.jmztab2.utils.errors.MZTabError;
import uk.ac.ebi.pride.jmztab2.utils.errors.MZTabErrorList;
import uk.ac.ebi.pride.jmztab2.utils.errors.MZTabErrorType;
import uk.ac.ebi.pride.jmztab2.utils.errors.MZTabErrorTypeMap;

/**
 * &lt;p&gt;
 * MZTabCommandLine class.&lt;/p&gt;
 *
 * @author qingwei
 * @author nilshoffmann
 * @since 17/09/13
 *
 */
<span class="nc" id="L57">public class MZTabCommandLine {</span>

<span class="nc" id="L59">    private static final Logger LOGGER = LoggerFactory.getLogger(</span>
        MZTabCommandLine.class);

    private static String getAppInfo() throws IOException {
<span class="nc" id="L63">        Properties p = new Properties();</span>
<span class="nc" id="L64">        p.load(MZTabCommandLine.class.getResourceAsStream(</span>
            &quot;/application.properties&quot;));
<span class="nc" id="L66">        StringBuilder sb = new StringBuilder();</span>
<span class="nc" id="L67">        String buildDate = p.getProperty(&quot;app.build.date&quot;, &quot;no build date&quot;);</span>
<span class="nc bnc" id="L68" title="All 2 branches missed.">        if (!&quot;no build date&quot;.equals(buildDate)) {</span>
<span class="nc" id="L69">            Instant instant = Instant.ofEpochMilli(Long.parseLong(buildDate));</span>
<span class="nc" id="L70">            buildDate = instant.toString();</span>
        }
        /*
         *Property keys are in src/main/resources/application.properties
         */
<span class="nc" id="L75">        sb.append(&quot;Running &quot;).</span>
<span class="nc" id="L76">            append(p.getProperty(&quot;app.name&quot;, &quot;undefined app&quot;)).</span>
<span class="nc" id="L77">            append(&quot;\n\r&quot;).</span>
<span class="nc" id="L78">            append(&quot; version: '&quot;).</span>
<span class="nc" id="L79">            append(p.getProperty(&quot;app.version&quot;, &quot;unknown version&quot;)).</span>
<span class="nc" id="L80">            append(&quot;'&quot;).</span>
<span class="nc" id="L81">            append(&quot;\n\r&quot;).</span>
<span class="nc" id="L82">            append(&quot; build-date: '&quot;).</span>
<span class="nc" id="L83">            append(buildDate).</span>
<span class="nc" id="L84">            append(&quot;'&quot;).</span>
<span class="nc" id="L85">            append(&quot;\n\r&quot;).</span>
<span class="nc" id="L86">            append(&quot; scm-location: '&quot;).</span>
<span class="nc" id="L87">            append(p.getProperty(&quot;scm.location&quot;, &quot;no scm location&quot;)).</span>
<span class="nc" id="L88">            append(&quot;'&quot;).</span>
<span class="nc" id="L89">            append(&quot;\n\r&quot;).</span>
<span class="nc" id="L90">            append(&quot; commit: '&quot;).</span>
<span class="nc" id="L91">            append(p.getProperty(&quot;scm.commit.id&quot;, &quot;no commit id&quot;)).</span>
<span class="nc" id="L92">            append(&quot;'&quot;).</span>
<span class="nc" id="L93">            append(&quot;\n\r&quot;).</span>
<span class="nc" id="L94">            append(&quot; branch: '&quot;).</span>
<span class="nc" id="L95">            append(p.getProperty(&quot;scm.branch&quot;, &quot;no branch&quot;)).</span>
<span class="nc" id="L96">            append(&quot;'&quot;).</span>
<span class="nc" id="L97">            append(&quot;\n\r&quot;);</span>
<span class="nc" id="L98">        return sb.toString();</span>
    }

    /**
     * &lt;p&gt;
     * Runs the command line parser for mzTab, including validation.&lt;/p&gt;
     *
     * @param args an array of {@link java.lang.String} objects.
     * @throws java.lang.Exception if any.
     */
    @SuppressWarnings(&quot;static-access&quot;)
    public static void main(String[] args) throws Exception {
<span class="nc" id="L110">        MZTabErrorTypeMap typeMap = new MZTabErrorTypeMap();</span>
<span class="nc" id="L111">        CommandLineParser parser = new PosixParser();</span>
<span class="nc" id="L112">        Options options = new Options();</span>
<span class="nc" id="L113">        String helpOpt = addHelpOption(options);</span>
<span class="nc" id="L114">        String versionOpt = addVersionOption(options);</span>
<span class="nc" id="L115">        String msgOpt = addMessageOption(options);</span>
<span class="nc" id="L116">        String outOpt = addOutFileOption(options);</span>
<span class="nc" id="L117">        String checkOpt = addCheckOption(options);</span>
<span class="nc" id="L118">        String levelOpt = addLevelOption(options);</span>
<span class="nc" id="L119">        String serializeOpt = addSerializeOption(options);</span>
<span class="nc" id="L120">        String deserializeOpt = addDeserializeOption(options);</span>
<span class="nc" id="L121">        String checkSemanticOpt = addCheckSemanticOption(options);</span>

        //TODO add option to set whether extra terms not defined in mapping file create a warning or error
//        options.addOption()
        // Parse command line
<span class="nc" id="L126">        CommandLine line = parser.parse(options, args);</span>
<span class="nc bnc" id="L127" title="All 4 branches missed.">        if (line.getOptions().length == 0 || line.hasOption(helpOpt)) {</span>
<span class="nc" id="L128">            HelpFormatter formatter = new HelpFormatter();</span>
<span class="nc" id="L129">            formatter.printHelp(&quot;jmztabm-cli&quot;, options);</span>
<span class="nc bnc" id="L130" title="All 2 branches missed.">        } else if (line.hasOption(msgOpt)) {</span>
<span class="nc" id="L131">            handleMsgOption(line, msgOpt, typeMap);</span>
<span class="nc bnc" id="L132" title="All 2 branches missed.">        } else if (line.hasOption(versionOpt)) {</span>
<span class="nc" id="L133">            LOGGER.info(getAppInfo());</span>
        } else {
<span class="nc" id="L135">            boolean hadErrorsOrWarnings = handleValidationOptions(line, outOpt,</span>
                levelOpt, serializeOpt,
                deserializeOpt, checkOpt, checkSemanticOpt);
<span class="nc bnc" id="L138" title="All 2 branches missed.">            if (hadErrorsOrWarnings) {</span>
<span class="nc" id="L139">                System.exit(1);</span>
            }
        }
<span class="nc" id="L142">    }</span>

    protected static String addVersionOption(Options options) {
<span class="nc" id="L145">        String versionOpt = &quot;version&quot;;</span>
<span class="nc" id="L146">        options.addOption(&quot;v&quot;, versionOpt, false, &quot;Print version information.&quot;);</span>
<span class="nc" id="L147">        return versionOpt;</span>
    }

    protected static String addHelpOption(Options options) {
<span class="nc" id="L151">        String helpOpt = &quot;help&quot;;</span>
<span class="nc" id="L152">        options.addOption(&quot;h&quot;, helpOpt, false, &quot;Print help message.&quot;);</span>
<span class="nc" id="L153">        return helpOpt;</span>
    }

    protected static String addCheckSemanticOption(Options options) throws IllegalArgumentException {
<span class="nc" id="L157">        String checkSemanticOpt = &quot;s&quot;;</span>
<span class="nc" id="L158">        Option checkSemanticOption = OptionBuilder.</span>
<span class="nc" id="L159">            withLongOpt(&quot;checkSemantic&quot;).</span>
<span class="nc" id="L160">            isRequired(false).</span>
<span class="nc" id="L161">            hasOptionalArgs(1).</span>
<span class="nc" id="L162">            withDescription(&quot;Example: -s /path/to/mappingFile.xml. Use the provided mapping file for semantic validation. If no mapping file is provided, the default one will be used. Requires an active internet connection!&quot;).</span>
<span class="nc" id="L163">            create(checkSemanticOpt);</span>
<span class="nc" id="L164">        options.addOption(checkSemanticOption);</span>
<span class="nc" id="L165">        return checkSemanticOpt;</span>
    }

    protected static String addDeserializeOption(Options options) {
<span class="nc" id="L169">        String deserializeOpt = &quot;fromJson&quot;;</span>
<span class="nc" id="L170">        options.addOption(null, deserializeOpt, false,</span>
            &quot;Example: --fromJson. Will parse inFile as JSON and write mzTab representation to disk. Requires validation to be successful!&quot;);
<span class="nc" id="L172">        return deserializeOpt;</span>
    }

    protected static String addSerializeOption(Options options) {
<span class="nc" id="L176">        String serializeOpt = &quot;toJson&quot;;</span>
<span class="nc" id="L177">        options.addOption(null, serializeOpt, false,</span>
            &quot;Example: --toJson. Will write a json representation of inFile to disk. Requires validation to be successful!&quot;);
<span class="nc" id="L179">        return serializeOpt;</span>
    }

    protected static String addLevelOption(Options options) {
<span class="nc" id="L183">        String levelOpt = &quot;l&quot;;</span>
<span class="nc" id="L184">        options.addOption(levelOpt, &quot;level&quot;, true,</span>
            &quot;Choose validation level (Info, Warn, Error), default level is Info!&quot;);
<span class="nc" id="L186">        return levelOpt;</span>
    }
    
    protected static String addCheckOption(Options options) throws IllegalArgumentException {
<span class="nc" id="L190">        String checkOpt = &quot;c&quot;;</span>
<span class="nc" id="L191">        Option checkSemanticOption = OptionBuilder.</span>
<span class="nc" id="L192">            withLongOpt(&quot;check&quot;).</span>
<span class="nc" id="L193">            isRequired(false).</span>
<span class="nc" id="L194">            hasArgs(1).</span>
<span class="nc" id="L195">            withDescription(&quot;Example: -c /path/to/file.mztab. Check and validate the provided a mzTab file.&quot;).</span>
<span class="nc" id="L196">            create(checkOpt);</span>
<span class="nc" id="L197">        options.addOption(checkSemanticOption);</span>
<span class="nc" id="L198">        return checkOpt;</span>
    }

    protected static String addOutFileOption(Options options) {
<span class="nc" id="L202">        String outOpt = &quot;o&quot;;</span>
<span class="nc" id="L203">        options.addOption(outOpt, &quot;outFile&quot;, true,</span>
            &quot;Example: -o \&quot;output.txt\&quot;. Record validation messages into outfile. If not set, print validation messages to stdout/stderr.&quot;);
<span class="nc" id="L205">        return outOpt;</span>
    }

    protected static String addMessageOption(Options options) throws IllegalArgumentException {
<span class="nc" id="L209">        String msgOpt = &quot;message&quot;;</span>
<span class="nc" id="L210">        Option msgOption = OptionBuilder.withLongOpt(&quot;message&quot;).hasArgs(1).</span>
<span class="nc" id="L211">            withDescription(</span>
                &quot;Example: -m 1002. Print validation message detail information based on error code.&quot;).
<span class="nc" id="L213">            create(&quot;m&quot;);</span>
<span class="nc" id="L214">        options.addOption(msgOption);</span>
<span class="nc" id="L215">        return msgOpt;</span>
    }

    protected static boolean handleValidationOptions(CommandLine line,
        String outOpt, String levelOpt, String serializeOpt,
        String deserializeOpt, String checkOpt, String checkSemanticOpt) throws JAXBException, IllegalArgumentException, URISyntaxException {
<span class="nc" id="L221">        File outFile = null;</span>
<span class="nc bnc" id="L222" title="All 2 branches missed.">        if (line.hasOption(outOpt)) {</span>
<span class="nc" id="L223">            outFile = new File(line.getOptionValue(outOpt));</span>
<span class="nc" id="L224">            LOGGER.info(&quot;Redirecting validator output to file {}&quot;, outFile);</span>
        }

<span class="nc bnc" id="L227" title="All 2 branches missed.">        try (PrintStream out = outFile == null ? System.out : new PrintStream(</span>
            new BufferedOutputStream(
                new FileOutputStream(outFile, false)), true, &quot;UTF8&quot;)) {
<span class="nc" id="L230">            System.setOut(out);</span>
<span class="nc" id="L231">            System.setErr(out);</span>
<span class="nc" id="L232">            LOGGER.info(getAppInfo());</span>
<span class="nc" id="L233">            MZTabErrorType.Level level = MZTabErrorType.Level.Info;</span>
<span class="nc bnc" id="L234" title="All 2 branches missed.">            if (line.hasOption(levelOpt)) {</span>
<span class="nc" id="L235">                level = MZTabErrorType.findLevel(line.getOptionValue(</span>
                    levelOpt));
<span class="nc" id="L237">                LOGGER.info(&quot;Validator set to level '{}'&quot;, level);</span>
            } else {
<span class="nc" id="L239">                LOGGER.info(</span>
                    &quot;Validator set to default level '{}'&quot;, level);
            }
<span class="nc" id="L242">            boolean serializeToJson = false;</span>
<span class="nc bnc" id="L243" title="All 2 branches missed.">            if (line.hasOption(serializeOpt)) {</span>
<span class="nc" id="L244">                serializeToJson = true;</span>
            }

<span class="nc" id="L247">            boolean deserializeFromJson = false;</span>
<span class="nc bnc" id="L248" title="All 2 branches missed.">            if (line.hasOption(deserializeOpt)) {</span>
<span class="nc" id="L249">                deserializeFromJson = true;</span>
            }
<span class="nc" id="L251">            return handleValidation(line, checkOpt, out, level,</span>
                checkSemanticOpt,
                serializeToJson, deserializeFromJson);
<span class="nc" id="L254">        } catch (IOException ex) {</span>
<span class="nc" id="L255">            LOGGER.error(</span>
                &quot;Caught an IO Exception: &quot;, ex);
<span class="nc" id="L257">            return false;</span>
        }
    }

    protected static void handleMsgOption(CommandLine line, String msgOpt,
        MZTabErrorTypeMap typeMap) throws NumberFormatException {
<span class="nc" id="L263">        String[] values = line.getOptionValues(msgOpt);</span>
<span class="nc" id="L264">        Integer code = new Integer(values[0]);</span>
<span class="nc" id="L265">        MZTabErrorType type = typeMap.getType(code);</span>

<span class="nc bnc" id="L267" title="All 2 branches missed.">        if (type == null) {</span>
<span class="nc" id="L268">            LOGGER.warn(</span>
                &quot;Could not find MZTabErrorType for code:&quot; + code);
        } else {
<span class="nc" id="L271">            LOGGER.info(&quot;MZTabErrorType for code {}: {}&quot;, code, type);</span>
        }
<span class="nc" id="L273">    }</span>

    protected static boolean handleValidation(CommandLine line, String checkOpt,
        PrintStream outFile, MZTabErrorType.Level level, String checkSemanticOpt,
        boolean toJson, boolean fromJson) throws URISyntaxException, JAXBException, IllegalArgumentException, IOException {
<span class="nc" id="L278">        boolean errorsOrWarnings = false;</span>
<span class="nc bnc" id="L279" title="All 2 branches missed.">        if (line.hasOption(checkOpt)) {</span>
<span class="nc" id="L280">            String value = line.getOptionValue(checkOpt);</span>
<span class="nc bnc" id="L281" title="All 2 branches missed.">            if (value == null) {</span>
<span class="nc" id="L282">                throw new IllegalArgumentException(&quot;No input file provided for validation!&quot;);</span>
            }
<span class="nc" id="L284">            File inFile = new File(value.trim());</span>
<span class="nc bnc" id="L285" title="All 2 branches missed.">            if (fromJson) {</span>
<span class="nc" id="L286">                File tmpFile = new File(inFile.getParentFile(),</span>
<span class="nc" id="L287">                    inFile.getName() + &quot;.mztab&quot;);</span>
<span class="nc" id="L288">                MzTabNonValidatingWriter w = new MzTabNonValidatingWriter();</span>
<span class="nc" id="L289">                ObjectMapper mapper = new ObjectMapper();</span>
<span class="nc" id="L290">                MzTab mzTab = mapper.readValue(inFile, MzTab.class);</span>
<span class="nc" id="L291">                LOGGER.info(&quot;Writing JSON as mzTab to file: {}&quot;, tmpFile.</span>
<span class="nc" id="L292">                    getAbsolutePath());</span>
<span class="nc" id="L293">                w.write(tmpFile.toPath(), mzTab);</span>
<span class="nc" id="L294">                inFile = tmpFile;</span>
            }
<span class="nc" id="L296">            LOGGER.info(&quot;Beginning validation of mztab file: {}&quot;, inFile.</span>
<span class="nc" id="L297">                getAbsolutePath());</span>
<span class="nc" id="L298">            MzTabFileParser mzTabParser = new MzTabFileParser(inFile);</span>
<span class="nc" id="L299">            MZTabErrorList errorList = mzTabParser.parse(outFile, level);</span>
<span class="nc bnc" id="L300" title="All 2 branches missed.">            if (!errorList.isEmpty()) {</span>
<span class="nc" id="L301">                long nErrorsOrWarnings = errorList.getErrorList().</span>
<span class="nc" id="L302">                    stream().</span>
<span class="nc" id="L303">                    filter((error) -&gt;</span>
                    {
<span class="nc" id="L305">                        MZTabError e = error;</span>
<span class="nc" id="L306">                        return e.getType().</span>
<span class="nc bnc" id="L307" title="All 2 branches missed.">                                getLevel() == MZTabErrorType.Level.Error || e.</span>
<span class="nc" id="L308">                                        getType().</span>
<span class="nc bnc" id="L309" title="All 2 branches missed.">                                        getLevel() == MZTabErrorType.Level.Warn;</span>
                    }).
<span class="nc" id="L311">                    count();</span>
<span class="nc bnc" id="L312" title="All 2 branches missed.">                errorsOrWarnings = nErrorsOrWarnings &gt; 0;</span>
                //these are reported to std.err already.
<span class="nc" id="L314">                LOGGER.error(</span>
<span class="nc" id="L315">                    &quot;There were &quot; + errorList.size() + &quot; validation messages including &quot; + nErrorsOrWarnings + &quot; warnings or errors during validation of your file, please check the output for details!&quot;);</span>
            }
<span class="nc bnc" id="L317" title="All 2 branches missed.">            if (toJson) {</span>
<span class="nc" id="L318">                File jsonFile = new File(inFile.getName() + &quot;.json&quot;);</span>
<span class="nc" id="L319">                LOGGER.error(</span>
                    &quot;Writing mzTab object as json to &quot; + jsonFile.
<span class="nc" id="L321">                        getAbsolutePath());</span>
<span class="nc" id="L322">                ObjectMapper objectMapper = new ObjectMapper().enable(</span>
                    SerializationFeature.INDENT_OUTPUT);
<span class="nc" id="L324">                objectMapper.</span>
<span class="nc" id="L325">                    writeValue(jsonFile, mzTabParser.getMZTabFile());</span>
            }
<span class="nc bnc" id="L327" title="All 4 branches missed.">            errorsOrWarnings = errorsOrWarnings || handleSemanticValidation(line,</span>
                checkSemanticOpt, inFile, outFile,
                mzTabParser, level);
<span class="nc" id="L330">            LOGGER.info(&quot;Finished validation!&quot;);</span>
        }
<span class="nc" id="L332">        return errorsOrWarnings;</span>
    }

    protected static boolean handleSemanticValidation(CommandLine line,
        String checkSemanticOpt, File inFile, PrintStream outFile,
        MzTabFileParser mzTabParser,
        MZTabErrorType.Level level) throws JAXBException, MalformedURLException, URISyntaxException {
<span class="nc" id="L339">        boolean errorsOrWarnings = false;</span>
<span class="nc bnc" id="L340" title="All 2 branches missed.">        if (line.hasOption(checkSemanticOpt)) {</span>
<span class="nc" id="L341">            String semValue = line.getOptionValue(</span>
                checkSemanticOpt);
            URI mappingFile;
<span class="nc bnc" id="L344" title="All 2 branches missed.">            if (semValue != null) {</span>
//                if (!&quot;mappingFile&quot;.equals(semValues[0])) {
//                    LOGGER.error(&quot;Please use the checkSemantic option as follows, if you want to supply a custom mapping file: '-checkSemantic mappingFile=&lt;path/to/mappingfile.xml&gt;'&quot;);
//                    return true;
//                }
                // read file from path
<span class="nc" id="L350">                mappingFile = new File(semValue.trim()).</span>
<span class="nc" id="L351">                    getAbsoluteFile().</span>
<span class="nc" id="L352">                    toURI();</span>
            } else {
<span class="nc" id="L354">                LOGGER.info(</span>
                    &quot;Using default mapping file from classpath: /mappings/mzTab-M-mapping.xml&quot;);
                // read default file
<span class="nc" id="L357">                mappingFile = CvMappingValidator.class.getResource(</span>
                    &quot;/mappings/mzTab-M-mapping.xml&quot;).
<span class="nc" id="L359">                    toURI();</span>
            }
<span class="nc" id="L361">            LOGGER.info(</span>
                &quot;Beginning semantic validation of mztab file: &quot; + inFile.
<span class="nc" id="L363">                    getAbsolutePath() + &quot; with mapping file: &quot; + mappingFile.</span>
<span class="nc" id="L364">                    toASCIIString());</span>
<span class="nc" id="L365">            CvMappingValidator cvMappingValidator = CvMappingValidator.of(</span>
<span class="nc" id="L366">                mappingFile.toURL(), true);</span>
<span class="nc" id="L367">            List&lt;ValidationMessage&gt; validationMessages = cvMappingValidator.</span>
<span class="nc" id="L368">                validate(mzTabParser.getMZTabFile()).</span>
<span class="nc" id="L369">                stream().</span>
<span class="nc" id="L370">                filter((message) -&gt;</span>
                {
<span class="nc bnc" id="L372" title="All 4 branches missed.">                    switch (level) {</span>
                        case Error:
<span class="nc bnc" id="L374" title="All 2 branches missed.">                            return message.getMessageType() == ERROR;</span>
                        case Warn:
<span class="nc bnc" id="L376" title="All 2 branches missed.">                            return message.getMessageType() == ERROR || message.</span>
<span class="nc bnc" id="L377" title="All 2 branches missed.">                                getMessageType() == WARN;</span>
                        case Info:
<span class="nc" id="L379">                            return true;</span>
                    }
<span class="nc" id="L381">                    return false;</span>
                }).
<span class="nc" id="L383">                collect(Collectors.toList());</span>
<span class="nc" id="L384">            long nErrorsOrWarnings = validationMessages.stream().</span>
<span class="nc" id="L385">                filter((validationMessage) -&gt;</span>
                {
<span class="nc bnc" id="L387" title="All 2 branches missed.">                    return validationMessage.getMessageType() == ValidationMessage.MessageTypeEnum.ERROR || validationMessage.</span>
<span class="nc bnc" id="L388" title="All 2 branches missed.">                        getMessageType() == ValidationMessage.MessageTypeEnum.WARN;</span>
                }).
<span class="nc" id="L390">                count();</span>
<span class="nc bnc" id="L391" title="All 2 branches missed.">            errorsOrWarnings = nErrorsOrWarnings &gt; 0;</span>
<span class="nc bnc" id="L392" title="All 2 branches missed.">            if (outFile != null) {</span>
<span class="nc bnc" id="L393" title="All 2 branches missed.">                for (ValidationMessage message : validationMessages) {</span>
<span class="nc" id="L394">                    outFile.print(message);</span>
<span class="nc" id="L395">                    outFile.println();</span>
<span class="nc" id="L396">                }</span>
            } else {
<span class="nc bnc" id="L398" title="All 2 branches missed.">                for (ValidationMessage message : validationMessages) {</span>
<span class="nc" id="L399">                    LOGGER.error(&quot;{}&quot;, message);</span>
<span class="nc" id="L400">                }</span>
            }
<span class="nc bnc" id="L402" title="All 2 branches missed.">            if (!validationMessages.isEmpty()) {</span>
<span class="nc" id="L403">                LOGGER.error(</span>
<span class="nc" id="L404">                    &quot;There were &quot; + validationMessages.size() + &quot; validation messages including &quot; + nErrorsOrWarnings + &quot; warnings or errors during semantic validation of your file, please check the output for details!&quot;);</span>
            } else {
<span class="nc" id="L406">                LOGGER.info(</span>
                    &quot;No errors found for semantic validation on level &quot; + level);
            }
        }
<span class="nc" id="L410">        return errorsOrWarnings;</span>
    }

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.6.202009150832</span></div></body></html>