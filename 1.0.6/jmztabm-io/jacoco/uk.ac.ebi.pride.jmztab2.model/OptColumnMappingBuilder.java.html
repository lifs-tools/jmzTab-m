<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>OptColumnMappingBuilder.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">jmztabm-io</a> &gt; <a href="index.source.html" class="el_package">uk.ac.ebi.pride.jmztab2.model</a> &gt; <span class="el_source">OptColumnMappingBuilder.java</span></div><h1>OptColumnMappingBuilder.java</h1><pre class="source lang-java linenums">/*
 * Copyright 2018 Leibniz-Institut für Analytische Wissenschaften – ISAS – e.V..
 *
 * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
package uk.ac.ebi.pride.jmztab2.model;

import de.isas.mztab2.model.IndexedElement;
import de.isas.mztab2.model.OptColumnMapping;
import de.isas.mztab2.model.Parameter;

/**
 * Builder for reusable {@link OptColumnMapping} creation for multiple rows.
 *
 * @author nilshoffmann
 */
public class OptColumnMappingBuilder implements IOptColumnMappingBuilder {

    private OptColumnMappingBuilder() {

    }

    private static class NameParamOptColumnMappingBuilder implements IOptColumnMappingBuilder {

        protected Parameter param;
        protected String name;

        /**
         * Configure this builder to create an optional column mapping with the
         * provided name. Mutually exclusive with {@link #withParameter(de.isas.mztab2.model.Parameter)
         * }.
         *
         * @param name the name of this optional column.
         * @return the builder instance.
         */
        IOptColumnMappingBuilder withName(String name) {
<span class="pc bpc" id="L47" title="1 of 2 branches missed.">            if (this.param != null) {</span>
<span class="nc" id="L48">                throw new IllegalStateException(</span>
                        &quot;Can not set name for opt column, parameter already has been set!&quot;);
            }
<span class="fc" id="L51">            this.name = name;</span>
<span class="fc" id="L52">            return this;</span>
        }

        /**
         * Configure this builder to create cv parameter optional columns.
         *
         * @param parameter the cv parameter for this mapping.
         * @return the builder instance.
         */
        IOptColumnMappingBuilder withParameter(Parameter parameter) {
<span class="fc bfc" id="L62" title="All 2 branches covered.">            if (this.name != null) {</span>
<span class="fc" id="L63">                throw new IllegalStateException(</span>
                        &quot;Can not set parameter for opt column, name has been set already!&quot;);
            }
<span class="pc bpc" id="L66" title="1 of 2 branches missed.">            if (parameter.getCvAccession() == null || parameter.getCvAccession().</span>
<span class="fc bfc" id="L67" title="All 2 branches covered.">                    isEmpty()) {</span>
<span class="fc" id="L68">                throw new IllegalArgumentException(</span>
                        &quot;Parameter must have cvAccession defined!&quot;);
            }
<span class="pc bpc" id="L71" title="1 of 2 branches missed.">            if (parameter.getCvLabel() == null || parameter.getCvLabel().</span>
<span class="fc bfc" id="L72" title="All 2 branches covered.">                    isEmpty()) {</span>
<span class="fc" id="L73">                throw new IllegalArgumentException(</span>
                        &quot;Parameter must have cvLabel defined!&quot;);
            }
<span class="pc bpc" id="L76" title="1 of 2 branches missed.">            if (parameter.getName() == null || parameter.getName().</span>
<span class="fc bfc" id="L77" title="All 2 branches covered.">                    isEmpty()) {</span>
<span class="fc" id="L78">                throw new IllegalArgumentException(</span>
                        &quot;Parameter must have name defined!&quot;);
            }
<span class="fc" id="L81">            this.param = parameter;</span>
<span class="fc" id="L82">            return this;</span>
        }
    }

    /**
     * Create a new {@link OptColumnMappingBuilder} for global optional columns.
     * Use this to create a global optional column, either with a dedicated
     * name, or with a parameter. This applies to all replicates.
     *
     * {@code
     *  opt_global_someProperty ... opt_global_cv_MS_MS:113123_parameter_name
     *  &lt;somePropertyValue&gt; ... &lt;parameter_name_value&gt;
     * }
     */
<span class="fc" id="L96">    public static class GlobalOptColumnMappingBuilder extends NameParamOptColumnMappingBuilder {</span>

        @Override
        public GlobalOptColumnMappingBuilder withName(String name) {
<span class="fc" id="L100">            super.withName(name);</span>
<span class="fc" id="L101">            return this;</span>
        }

        @Override
        public GlobalOptColumnMappingBuilder withParameter(Parameter parameter) {
<span class="fc" id="L106">            super.withParameter(parameter);</span>
<span class="fc" id="L107">            return this;</span>
        }

        @Override
        public OptColumnMapping build(String value) {

<span class="fc bfc" id="L113" title="All 2 branches covered.">            if (this.param != null) {</span>
<span class="fc" id="L114">                return new OptColumnMapping().param(param).</span>
<span class="fc" id="L115">                        value(value).</span>
<span class="fc" id="L116">                        identifier(ParameterOptionColumn.getHeader(null, param));</span>
            } else {
<span class="pc bpc" id="L118" title="1 of 2 branches missed.">                if(name == null) {</span>
<span class="nc" id="L119">                    throw new IllegalArgumentException(&quot;Name must be defined if parameter is not set!&quot;);</span>
                }
<span class="fc" id="L121">                return new OptColumnMapping().value(value).</span>
<span class="fc" id="L122">                        identifier(OptionColumn.getHeader(null, name));</span>
            }
        }
    }

    /**
     * Create a new {@link OptColumnMappingBuilder} for {@link IndexedElement}.
     * Either referencing an indexed element property with a dedicated name, or
     * with a parameter. This applies only to the referenced objects.
     *
     * {@code
     *  opt_assay[1]_someProperty ... opt_assay[1]_cv_MS_MS:113123_parameter_name
     *  &lt;somePropertyValue&gt; ... &lt;parameter_name_value&gt;
     * }
     */
    public static class IndexedElementOptColumnMappingBuilder extends NameParamOptColumnMappingBuilder {

        private final Object indexedElement;

        @Override
        public IndexedElementOptColumnMappingBuilder withName(String name) {
<span class="fc" id="L143">            super.withName(name);</span>
<span class="fc" id="L144">            return this;</span>
        }

        @Override
        public IndexedElementOptColumnMappingBuilder withParameter(Parameter parameter) {
<span class="fc" id="L149">            super.withParameter(parameter);</span>
<span class="fc" id="L150">            return this;</span>
        }

        /**
         * Configure this builder to create optional column mapping for an
         * indexed element, such as
         * {@link de.isas.mztab2.model.Assay}, {@link de.isas.mztab2.model.StudyVariable},
         * or {@link de.isas.mztab2.model.MsRun}.
         *
         * @param indexedElement the indexed element to reference in this
         * optional column.
         */
<span class="fc" id="L162">        public IndexedElementOptColumnMappingBuilder(Object indexedElement) {</span>
<span class="fc" id="L163">            this.indexedElement = indexedElement;</span>
<span class="fc" id="L164">        }</span>

        @Override
        public OptColumnMapping build(String value) {
<span class="pc bpc" id="L168" title="1 of 2 branches missed.">            if (this.indexedElement == null) {</span>
<span class="nc" id="L169">                throw new IllegalArgumentException(&quot;Indexed element must not be null!&quot;);</span>
            }
<span class="fc bfc" id="L171" title="All 2 branches covered.">            if (this.param != null) {</span>
<span class="fc" id="L172">                return new OptColumnMapping().param(param).</span>
<span class="fc" id="L173">                        value(value).</span>
<span class="fc" id="L174">                        identifier(ParameterOptionColumn.getHeader(indexedElement, param));</span>
            } else {
<span class="pc bpc" id="L176" title="1 of 2 branches missed.">                if(name == null) {</span>
<span class="nc" id="L177">                    throw new IllegalArgumentException(&quot;Name must be defined if parameter is not set!&quot;);</span>
                }
<span class="fc" id="L179">                return new OptColumnMapping().value(value).</span>
<span class="fc" id="L180">                        identifier(OptionColumn.getHeader(indexedElement, name));</span>
            }
        }
    }

    /**
     * Configure the builder for a global type column.
     *
     * @return the builder instance for a global opt column.
     */
    public static GlobalOptColumnMappingBuilder forGlobal() {
<span class="fc" id="L191">        return new GlobalOptColumnMappingBuilder();</span>
    }

    /**
     * Configure the builder for an object reference (indexed element) type
     * column.
     *
     * @param indexedElement the object to reference.
     * @return the builder instance for an indexed element opt column.
     */
    public static IndexedElementOptColumnMappingBuilder forIndexedElement(Object indexedElement) {
<span class="fc" id="L202">        return new IndexedElementOptColumnMappingBuilder(indexedElement);</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.6.202009150832</span></div></body></html>